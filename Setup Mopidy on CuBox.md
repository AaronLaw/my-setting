Setup Mopidy on CuBox
====

2014-10

Firstly, I try to run MuBox as music service. But it doesn't work (decode error). Then I decide to run Mopidy as the mpd.

## Summary

`/music/Mopidy-MusicBox-Webclient/build/lib.linux-armv71-2.7/mopidy_musicbox_webclient/`

mopidy's config: `/root/.config/mopidy/mopidy.conf`
mopidy's music folder is: `/music/`

After booting:

Debian user & password:

    root, kimxxxmusic

    df -h

    mount /dev/sda1 /music
    ls /music/

mopidy local scan
mopidy
-> 192.168.0.20:6680


(
as running as a system service:
mopidy's config: /etc/mopidy/mopidy.conf
mopidy local scan -> sudo service mopidy run local scan
)

(
if Mopidy runs as system service not working, try to run it `mopidy`:

    sudo service mopidy stop
    
    mopidy
)
----

### Problems: 

after boot up, mpd starts but :6680 can't use
1. no ape
2. no chinese song name?

----

2014-10-11:

sound devices cannot play (speaker-test)
1.
	1. list error msg
	2. email back

2.
	1. install an ordinary Debian
	2. speaker-test again

Email:
http://www.solid-run.com/community/topic1782.html

Dear sir,

I get this CuBox as CAS for playing music, with the use of mpd. After trying RuneAudio, MuBox (this OS is made for CuBox as CAS), or finally I manally install mpd myself (on the Debain of the previous email you sent me), the CuBox of mine plays no sound.

(I use a X20 DAC, and have no SPFID)

`speaker-test -Dnurround40:x20 -c 2` shows me error:

    Playback device is surround40:X20
    Stream parameters are 48000Hz, S16_LE, 2 channels
    Using 16 octaves of pink noise
    Sample format not available for playback: Invalid argument
    Setting of hwparams failed: Invalid argument
    root@cubox-i:~#


`speaker-test -Ddefault_imxspdif -c2' shows error too:

    root@cubox-i:~# speaker-test -Ddefault:imxspdif -c2

    speaker-test 1.0.25

    Playback device is default:imxspdif
    Stream parameters are 48000Hz, S16_LE, 2 channels
    Using 16 octaves of pink noise
    Rate set to 48000Hz (requested 48000Hz)
    Buffer size range from 128 to 16384
    Period size range from 32 to 4096
    Using max buffer size 16384
    Periods = 4
    was set period_size = 4096
    was set buffer_size = 16384
     0 - Front Left
    Write error: -5,Input/output error
    xrun_recovery failed: -5,Input/output error
    Transfer failed: Operation not permitted
    root@cubox-i:~# 


Do you know what can I do now?

Thanks for you help.

----

2014-10-2:

Sound plays back on the X20 DAC, with the following command:

    speaker-test -Ddefault:X20 -c 2

Then, it's time to change the default sound device  to 2 by creating `/etc/asound.conf` with: (X20 is device 2)

    pcm.!default {
        type plug
        slave.pcm {
          type hw
          card 2
        }
    }
    
    ctl.!default {
        type plug
        slave.pcm {
          type hw
          card 2
        }
    }

Then, speaker-test -c 2 has sound, but there is no sound in Mopidy.
Change to alsasink and then Mopidy has sound. (https://docs.mopidy.com/en/latest/installation/raspberrypi/)

    sudo apt-get install gstreamer0.10-alsa
    
    [audio]
    output = alsasink

----
2014-10-23:

Install hardware mixer.

Install `pip` first, then install `Mopidy-ALSAMixer`

    pip install Mopidy-ALSAMixer
    sudo apt-get install python-alsaaudio # Mopidy-ALSAMixer dependes on it.

Then change the setting in config file `~/.config/mopidy`

    [audio]
    mixer = hardware
    [alsamixer]
    card = 2 # X20 is no.2
    control = XMOS Clock Selector

Ref: https://docs.mopidy.com/en/latest/config/ -> https://github.com/mopidy/mopidy-alsamixer
----
2014-10-23:

Set Mopidy using Init scripts (running as a system service)

    sudo dpkg-reconfigure mopidy

the config file is localed at: `/etc/mopidy`. So the .conf file is `/etc/mopidy/mopid.conf` 

Ref: https://docs.mopidy.com/en/latest/running/
https://docs.mopidy.com/en/latest/debian/#debian
----
2014-10-23:

Let linux debian auto mount usb drive after booting

Google: linux debian auto mount usb drive
Google: cubox debian auto mount usb drive


    apt-get install autofs
    apt-get install udisks

    df -h

now, the USB drive containing music is mounted at /media/usb0

Ref: http://www.solid-run.com/archive/phpbb/viewtopic.php?f=2&t=804&view=next
----

### Reference

The `mopidy.conf`, which is generated by Mopidy running as system service: (`/etc/mopidy/mopidy.conf`)

[logging]
config_file = /etc/mopidy/logging.conf
debug_file = /var/log/mopidy/mopidy-debug.log

[local]
enabled = true
data_dir = /var/lib/mopidy/local
media_dir = /var/lib/mopidy/media
playlists_dir = /var/lib/mopidy/playlists

